<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–≥—Ä–∞</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/game.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <!-- –õ–µ–≤–∞—è –∑–æ–Ω–∞ -->
            <div class="nav-left">
                <a href="index.html" class="nav-brand">‚Üê –ù–∞–∑–∞–¥</a>
            </div>
            
            <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∑–æ–Ω–∞ - –û–ß–ö–ò -->
            <div class="nav-center">
                <div class="score-display">
                    <span class="score-label">–û—á–∫–∏:</span>
                    <span id="score" class="score-value">0</span>
                    <!-- –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∑–¥–µ—Å—å, —Å–ø—Ä–∞–≤–∞ –æ—Ç –æ—á–∫–æ–≤ -->
                </div>
            </div>
            
            <!-- –ü—Ä–∞–≤–∞—è –∑–æ–Ω–∞ -->
            <div class="nav-right">
                <!-- –ö–æ–º–±–æ - –≤—Å–µ–≥–¥–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –º–µ—Å—Ç–æ -->
                <div id="combo-display" class="combo-display inactive">
                    <span class="combo-icon">üî•</span>
                    <span id="combo" class="combo-value">0</span>
                </div>
                
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞—Ä -->
                <div id="game-stats" class="game-stats">
                    <span id="matched-count">0</span> / <span id="total-count">25</span>
                </div>
                
                <!-- Dropdown –≤—ã–±–æ—Ä–∞ —Ç–µ–º—ã -->
                <div class="theme-selector">
                    <select id="theme-select" class="theme-select" aria-label="–í—ã–±—Ä–∞—Ç—å —Ç–µ–º—É –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è">
                        <option value="light">‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è</option>
                        <option value="dark">üåô –¢—ë–º–Ω–∞—è</option>
                        <option value="light-alt">üå∏ –¢—ë–ø–ª–∞—è</option>
                        <option value="dark-alt">üî• –°–∏–Ω—è—è</option>
                    </select>
                </div>
                
                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–≤—É–∫–æ–º -->
                <div class="sound-controls">
                    <button id="sound-toggle" class="sound-btn" aria-label="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫–∏">
                        <span class="sound-icon">üîä</span>
                    </button>
                    <input 
                        type="range" 
                        id="volume-slider" 
                        class="volume-slider"
                        min="0" 
                        max="100" 
                        value="50"
                        aria-label="–ì—Ä–æ–º–∫–æ—Å—Ç—å –∑–≤—É–∫–æ–≤"
                    >
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞ (–¥–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) -->
                <a href="index.html" id="login-btn" class="nav-btn nav-btn-compact">
                    üîê
                </a>
                
                <!-- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) -->
                <div id="user-profile" class="user-profile user-profile-compact" style="display: none;">
                    <button class="user-profile-btn user-profile-btn-compact">
                        <span class="user-avatar">üë§</span>
                        <span class="user-name" id="user-name">–ò–≥—Ä–æ–∫</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="game-container">
        <div id="game-header" class="game-header">
            <h1 id="game-title">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
            <p id="game-description"></p>
        </div>

        <div id="game-board" class="game-board">
            <div class="column left-column">
                <h2 id="left-column-title" class="column-title">–õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞</h2>
                <div id="left-cards" class="cards-container">
                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>

            <div class="column right-column">
                <h2 id="right-column-title" class="column-title">–ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞</h2>
                <div id="right-cards" class="cards-container">
                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>

        <div id="game-completed" class="game-completed hidden">
            <div class="completion-card">
                <div class="completion-icon">üéâ</div>
                <h2>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h2>
                <p>–í—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–ø–æ—Å—Ç–∞–≤–∏–ª–∏ –≤—Å–µ –ø–∞—Ä—ã!</p>
                <div class="completion-buttons">
                    <button id="play-again" class="btn btn-primary">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                    <a href="index.html" class="btn btn-secondary">–í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é —Ç–µ–º—É</a>
                </div>
            </div>
        </div>
    </main>

    <!-- Firebase SDK (–ü–ï–†–í–´–ú!) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- Auth System -->
    <script src="js/firebase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/progress.js"></script>
    
    <!-- Sound Manager -->
    <script src="js/sound-manager.js"></script>
    
    <!-- MVC Architecture v4.0 -->
    <script src="js/game-model.js"></script>
    <script src="js/game-view.js"></script>
    <script src="js/game-controller.js"></script>
    
    <!-- Drag & Drop Manager -->
    <script src="js/drag-drop.js"></script>
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
        const theme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', theme);
        document.querySelector('.theme-icon').textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        
        document.getElementById('theme-toggle').addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            document.querySelector('.theme-icon').textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        });
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // BOOTSTRAP –ü–†–û–¶–ï–°–° (MVC v4.0)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã (MVC v4.0)...');
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
                const urlParams = new URLSearchParams(window.location.search);
                const themeId = urlParams.get('theme');
                const difficulty = parseInt(urlParams.get('difficulty')) || 1;
                
                // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                if (!themeId) {
                    throw new Error('–ù–µ —É–∫–∞–∑–∞–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä theme –≤ URL');
                }
                
                if (difficulty < 1 || difficulty > 3) {
                    throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 1-3)');
                }
                
                // –°–æ–∑–¥–∞—ë–º MVC –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
                const model = new GameModel();
                const view = new GameView();
                const controller = new GameController(model, view);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è drag-drop
                window.gameController = controller;
                window.gameModel = model; // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
                window.gameView = view;   // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º bootstrap –ø—Ä–æ—Ü–µ—Å—Å
                await controller.bootstrap(themeId, difficulty);
                
                console.log('‚úÖ –ò–≥—Ä–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
                
            } catch (error) {
                console.error('üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –æ—à–∏–±–∫–∏
                const errorHTML = `
                    <div style="
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0, 0, 0, 0.9);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        z-index: 10000;
                    ">
                        <div style="
                            text-align: center;
                            background: white;
                            padding: 3rem;
                            border-radius: 20px;
                            max-width: 500px;
                        ">
                            <div style="font-size: 4rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                            <h2 style="font-size: 1.75rem; margin-bottom: 1rem;">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞</h2>
                            <p style="font-size: 1.125rem; margin-bottom: 2rem; color: #666;">${error.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä—É'}</p>
                            <button onclick="location.reload()" style="
                                padding: 0.875rem 2rem;
                                background: #2563eb;
                                color: white;
                                border: none;
                                border-radius: 12px;
                                font-size: 1rem;
                                cursor: pointer;
                                margin-right: 0.5rem;
                            ">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                            <a href="index.html" style="
                                display: inline-block;
                                padding: 0.875rem 2rem;
                                background: #f3f4f6;
                                color: #1f2937;
                                border-radius: 12px;
                                font-size: 1rem;
                                text-decoration: none;
                            ">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç–µ–º–∞–º</a>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', errorHTML);
            }
        });
    </script>
</body>
</html>
